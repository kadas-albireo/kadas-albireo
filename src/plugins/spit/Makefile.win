QGTOP=../../../

OBJECTS = $(wildcard *.o) 

PLUGIN = .libs/spitplugin.dll

all: objects $(PLUGIN)

objects:
	$(MAKE) -f Makefile 

$(PLUGIN): $(OBJECTS)
	$(CXX) -shared -o $@ \
		-Wl,--export-all-symbols \
		-Wl,--enable-auto-import \
		-Wl,--whole-archive $(OBJECTS) \
		-Wl,--no-whole-archive \
			-L ../../providers/postgres/.libs/ -lpostgresprovider  -lpq \
		-lwsock32 \
			$(PLUGIN_LIBS) 
	$(STRIP) $@ 

#			../../providers/grass/.libs/libqgisgrass.a \

install: all 
	$(INSTALL) -m 755 $(PLUGIN) $(prefix)/lib/qgis/spitplugin.dll

include $(QGTOP)/Makefile.win.rules
